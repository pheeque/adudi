<template>
  <div v-if="data" class="flex flex-col justify-center p-16">
    <svg class="h-32" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M163.749 473.724C141.676 406.975 83.455 357.763 10 359.19v114.535h153.749v-.001z" fill="#5bd185"/><path d="M10 359.19c73.455-1.427 131.676 47.786 153.749 114.535h191.25C267.675 348.475 135.954 278.518 10 281.445v77.745z" fill="#c8e27c"/><path d="M10 297.689c125.954-2.928 237.425 50.786 324.748 176.035h167.25v-23.786C338.175 283.439 109.749 243.69 10 251.94v45.749z" fill="#5bd185"/><path d="M10 251.94c99.749-8.25 328.175 31.5 491.998 197.999v-106.11c-32.362-17.897-63.991-33.455-94.611-46.955-34.434-15.179-67.594-27.755-99.091-38.123-30.957-10.19-60.309-18.246-87.688-24.546C110.504 208.872 32.311 211.961 10 219.064v32.876z" fill="#c8e27c"/><path d="M501.998 290.939c-33.052-7.5-69.314-3.126-94.611 5.935 30.621 13.499 62.25 29.058 94.611 46.954v-52.889z" fill="#5bd185"/><path d="M407.387 296.874c25.299-9.061 61.56-13.435 94.611-5.935v-46.875c-78.321-16.937-173.279-4.946-217.682 7.114 31.498 10.37 88.637 30.516 123.071 45.696z" fill="#c8e27c"/><path d="M308.295 258.751c44.402-12.061 115.382-20.372 193.703-3.436v-36.251c-38.524-12.265-189.059-32.185-281.391 15.141 27.38 6.3 56.731 14.356 87.688 24.546z" fill="#5bd185"/><circle cx="171.449" cy="77.27" r="39" fill="#ffc16d"/><path d="M505.031 209.536c-22.446-7.146-72.056-14.678-123.44-15.247-45.93-.505-110.986 4.241-162.364 29.422-108.42-24.554-187.012-22.215-212.26-14.175A9.998 9.998 0 0 0 0 219.064v254.66c0 5.523 4.477 10 10 10h153.673c.025 0 .049.003.074.003.025 0 .049-.003.074-.003H334.74l.017.001.026-.001h167.215c5.522 0 10-4.477 10-10V344.028a8.066 8.066 0 0 0 0-.381V219.064a9.998 9.998 0 0 0-6.967-9.528zm-13.033 117.47a1181.542 1181.542 0 0 0-54.698-27.46c16.489-2.755 35.643-3.555 54.698-.375v27.835zm0-100.353v52.285c-31.495-4.566-62.835.257-84.219 7.24a1118.866 1118.866 0 0 0-62.603-25.101c22.628-3.688 46.765-5.548 70.496-5.325 5.492.054 10.041-4.382 10.095-9.905.052-5.523-4.383-10.042-9.905-10.094-46.877-.437-83.894 6.443-107.433 12.614a1027.953 1027.953 0 0 0-56.393-16.617c85.647-29.57 201.383-14.73 239.962-5.097zm-316.435 8.542c72.694 12.979 186.228 43.382 316.435 114.547v76.446c-88.177-82.889-187.334-127.32-256.893-150.275-42.59-14.056-85.601-24.095-127.839-29.838-31.896-4.337-61.796-5.968-87.266-4.79v-14.359c23.425-4.341 79.113-5.381 155.563 8.269zM20 369.33c56.894 2.705 105.871 38.542 129.329 94.395H20V369.33zm319.909 94.394c-62.417-87.803-139.303-143.449-228.621-165.378a9.998 9.998 0 0 0-12.097 7.327c-1.316 5.363 1.964 10.779 7.327 12.096 80.564 19.78 150.677 68.849 208.647 145.956H170.83c-12.125-32.617-32.269-60.427-58.574-80.748C85.397 362.229 53.671 350.682 20 349.302v-87.985c46.871-2.231 123.5 5.426 208.838 33.589 71.238 23.509 174.379 70.164 263.16 159.158v9.662l-152.089-.002zM171.446 126.272c27.019 0 49-21.981 49-49s-21.981-49-49-49-49 21.981-49 49 21.982 49 49 49zm0-77.999c15.99 0 29 13.009 29 29s-13.01 29-29 29-29-13.009-29-29 13.01-29 29-29z"/><path d="M445.089 257.054l.549.044c.272.021.54.032.808.032 5.162 0 9.539-3.97 9.958-9.204.44-5.505-3.667-10.325-9.172-10.765l-.584-.046a9.99 9.99 0 0 0-10.749 9.191c-.43 5.505 3.684 10.317 9.19 10.748zM81.479 292.342a2.43 2.43 0 0 0-.097-.015c-5.436-.907-10.6 2.772-11.508 8.22-.907 5.448 2.772 10.6 8.221 11.508l.257.041a10.05 10.05 0 0 0 1.576.125c4.833 0 9.085-3.513 9.864-8.438.862-5.456-2.859-10.578-8.313-11.441z"/></svg>
    <a-progress :percent="percentage()" status="active"/>
    <div>Lv.{{ data.level }}</div>
  </div>
</template>

<script>
  import Api from '../../api/mascot'
  import Bus from '../../bus'

  export default {
    props: ['id'],
    created() {
      this.fetch()
      Bus.$on('complete', payload => {
        Api.update(this.id, {
          exp: this.data.exp + 1
        })
        .then(response => {
          this.data = Object.assign({}, this.data, {
            exp: this.data.exp + 1
          })
        })
      })
      Bus.$on('uncomplete', payload => {
        Api.update(this.id, {
          exp: this.data.exp - 1
        })
        .then(response => {
          this.data = Object.assign({}, this.data, {
            exp: this.data.exp - 1
          })
        })
      })
    },
    data() {
      return {
        data: null
      }
    },

    methods: {
      fetch() {
        Api.find(this.id)
          .then(response => {
            this.data = Object.assign({}, response.data.data)
          })
      },
      level() {
        if (this.data.level === 1) return 200

        if (this.data.level === 2) return 500
      },
      percentage() {
        return parseFloat((this.data.exp / this.level() * 100).toFixed(1))
      }
    },
  }
</script>